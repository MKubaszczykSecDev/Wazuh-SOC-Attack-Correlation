<!-- Local rules -->

<!-- Modify it at your will. -->
<!-- Copyright (C) 2015, Wazuh Inc. -->
<!-- Example -->


<group name="ssh_custom_group,">

<!-- Custom Rule: Baseline for detecting Failed SSH Auth. Attempts -->

<rule id="100000" level="5">
    <if_sid>5760, 5716</if_sid>
    <description>SSH authentication failure detected</description>
  </rule>

<!-- Custom Rule for Detecting if the multiple failed SSH Auth. attempts came from the same IP -->

  <rule id="100001" level="10" frequency="8" timeframe="60">
    <if_matched_sid>100000</if_matched_sid>
    <same_srcip />
    <description>Multiple SSH authentication failures detected from the same IP address</description>
    <mitre>
      <id>T1110</id>
    </mitre>
  </rule>

<!-- Custom Rule for detecting direct root SSH Login Attempts -->

  <rule id="100002" level="12" frequency="3" timeframe="30">
    <if_matched_sid>100000</if_matched_sid>
    <match>root</match>
    <description>SSH root login attempt detected</description>
    <mitre>
      <id>T1078.003</id>
    </mitre>
  </rule>

<!-- Cutom Rule for detecting a Successful Login after Brute Force Attack -->

  <rule id="100003" level="14">
    <if_sid>5715</if_sid>
    <if_matched_sid>100001</if_matched_sid>
    <same_srcip />
    <description>Successful SSH login following a brute force attack</description>
    <mitre>
      <id>T1110</id>
    </mitre>
  </rule>

<!-- Custom Rule for auditing SSH Key Based Authentication Logins -->

  <rule id="100004" level="3" overwrite="yes">
    <if_sid>5715</if_sid>
    <match>publickey</match>
    <description>Successful SSH key based authentication</description>
    <mitre>
      <id>T1021.002</id>
    </mitre>
  </rule>

</group>

<!-- Custom Rule for Monitoring if sys auth. files have been modified or copied-->

<group name="syscheck,critical_sys_files,">
  <rule id="100010" level="13">
    <if_sid>550, 554</if_sid>
    <field name="file">^/etc/passwd|^/etc/shadow|^/etc/group</field>
    <description>System authentication file $(file) was modified or copied</description>
  </rule>
</group>

<!-- Custom Rule: Baseline for rule 100012, it collects currently running processes on agent -->

<group name="monitoring_for_netcat,">
<rule id="100011" level="0">
    <if_sid>530</if_sid>
    <match>^ossec: output: 'process list'</match>
    <description>Collecting running processes from endpoint</description>
  </rule>

<!-- Custom Rule for detecting if netcat/nc is running -->

  <rule id="100012" level="12" ignore="60">
    <if_sid>100011</if_sid>
    <match>nc -l|ncat -l|netcat -l</match>
    <description>Unauthorized listener detected. (Possible backdoor)</description>
    <mitre>
      <id>T1567</id>
      <id>T1059</id>
    </mitre>
    <group>backdoor_detection,process_monitor,</group>
  </rule>
</group>


